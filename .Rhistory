dat.list<- df.to.list(dat)
obs<- get.summary.stats_behav(dat)
#prepare for Gibbs sampler
ngibbs=1000
nburn=ngibbs/2
ind1=grep('y1',colnames(obs))
ind2=grep('y2',colnames(obs))
nmaxclust=max(length(ind1),length(ind2))-1  #max possible is 1 fewer than largest number of bins
res=LDA_behavior_gibbs(dat=obs,gamma1=gamma1,alpha=alpha,
ngibbs=ngibbs,nmaxclust=nmaxclust,
nburn=nburn)
View(res)
#Check traceplot of log marginal likelihood
plot(res$loglikel,type='l')
#Extract and plots proportions of behaviors per time segment
theta.post<- res$theta[(nburn+1):ngibbs,] %>% apply(2, mean)  #calc mean of posterior
theta.estim=matrix(theta.post, nrow(obs), nmaxclust)
boxplot(theta.estim)
#Determine proportion of behaviors (across all time segments)
#Possibly set threshold below which behaviors are excluded
round(apply(theta.estim, 2, sum)/nrow(theta.estim), digits = 3)
behav.res<- get_behav_hist(res)
#Plot histograms of frequency data
ggplot(behav.res, aes(x = bin, y = count, fill = behav)) +
geom_bar(stat = 'identity') +
scale_fill_viridis_c(guide = F, direction = -1) +
labs(x = "\nBin", y = "Frequency\n") +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14), strip.text.x = element_text(face = "bold")) +
facet_grid(param ~ behav, scales = "free_y")
#Plot histograms of proportion data
ggplot(behav.res, aes(x = bin, y = prop, fill = behav)) +
geom_bar(stat = 'identity') +
scale_fill_viridis_c(guide = F, direction = -1) +
labs(x = "\nBin", y = "Proportion\n") +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14), strip.text.x = element_text(face = "bold")) +
facet_grid(param ~ behav, scales = "fixed")
theta.estim<- data.frame(id = obs$id, tseg = obs$tseg, theta.estim)
names(theta.estim)<- c("id", "tseg", 1:nmaxclust)  #define behaviors
nobs<- purrr::map_dfr(dat.list, obs.per.tseg)  #calc obs per tseg
#Create augmented matrix by replicating rows (tsegs) according to obs per tseg
theta.estim2<- aug_behav_df(dat = dat, theta.estim = theta.estim, nobs = nobs)
#Create augmented matrix by replicating rows (tsegs) according to obs per tseg
theta.estim2<- aug_behav_df(dat = dat, theta.estim = theta.estim, nobs = nobs)
#------------------------------------------------
aug_behav_df=function(dat, theta.estim, nobs) {  #augment from time segments to observations
for (i in 1:nrow(theta.estim)) {
ind<- which(dat$id == theta.estim$id[i] & dat$tseg == theta.estim$tseg[i])
if (i == 1) {
theta.estim2<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
} else {
tmp<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
theta.estim2<- rbind(theta.estim2, tmp)
}
}
colnames(theta.estim2)<- names(theta.estim)
theta.estim2<- data.frame(theta.estim2, time1 = dat$time1, date = dat$date)
theta.estim2
}
#Create augmented matrix by replicating rows (tsegs) according to obs per tseg
theta.estim2<- aug_behav_df(dat = dat, theta.estim = theta.estim, nobs = nobs)
#Change into long format
theta.estim.long<- theta.estim2 %>% gather(key, value, -id, -tseg, -time1, -date)
theta.estim.long$date<- theta.estim.long$date %>% as_datetime()
names(theta.estim.long)[5:6]<- c("behavior","prop")
#lines
ggplot(theta.estim.long) +
geom_path(aes(x=time1, y=prop, color = behavior)) +
labs(x = "\nObservation", y = "State Probability\n") +
scale_color_viridis_d("Behavior", direction = -1) +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
facet_wrap(~id, scales = "free_x")
#stacked area
ggplot(theta.estim.long) +
geom_area(aes(x=time1, y=prop, fill = behavior), color = "black", size = 0.25,
position = "fill") +
labs(x = "\nObservation", y = "State Probability\n") +
scale_fill_viridis_d("Behavior", direction = -1) +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
facet_wrap(~id, scales = "free_x")
#Window of peak breeding (March 1 - June 30)
breed<- data.frame(xmin = as_datetime(c("2016-03-01 00:00:00","2017-03-01 00:00:00",
"2018-03-01 00:00:00","2019-03-01 00:00:00")),
xmax = as_datetime(c("2016-06-30 23:59:59","2017-06-30 23:59:59",
"2018-06-30 23:59:59","2019-06-30 23:59:59")),
ymin = -Inf, ymax = Inf)
#lines
ggplot() +
geom_rect(data = breed, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
fill = "grey", alpha = 0.5) +
geom_path(data = theta.estim.long, aes(x=date, y=prop, color = behavior)) +
labs(x = "\nTime", y = "State Probability\n") +
scale_color_viridis_d("Behavior", direction = -1) +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
facet_wrap(~id)
#stacked area
ggplot(theta.estim.long) +
geom_area(aes(x=date, y=prop, fill = behavior), color = "black", size = 0.25,
position = "fill") +
geom_rect(data = breed, aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax),
fill = "grey", alpha = 0.25) +
labs(x = "\nTime", y = "State Probability\n") +
scale_fill_viridis_d("Behavior", direction = -1) +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
facet_wrap(~id)
#Add cluster assignments to original data; one column for dominant behavior and another for prop/prob to use for alpha of points
dat2<- assign_behav(dat.list = dat.list, theta.estim2 = theta.estim2)
i=1
tmp<- matrix(0, nrow(dat.list[[i]]), 2)
sub<- theta.estim2[theta.estim2$id == unique(dat.list[[i]]$id),]
View(sub)
for (j in 1:nrow(sub)) {
ind<- which.max(sub[j,3:9])
tmp[j,1]<- names(ind) %>% as.character()
tmp[j,2]<- round(sub[j,(2+ind)], 3) %>% as.numeric()
}
which.max(sub[j,3:9])
colnames(tmp)<- c("behav","prop")
cbind(dat.list[[i]], tmp)
dat.list[[i]]$behav %>% as.character()
View(sub)
View(dat.list)
View(dat.list[["1"]])
colnames(tmp)<- c("behav","prop")
dat.list[[i]]<- cbind(dat.list[[i]], tmp)
View(dat.list[["1"]])
dat.list[[i]]$behav %>% as.character()
dat.list[[i]]$prop %>% as.character()
#------------------------------------------------
assign_behav=function(dat.list, theta.estim2) {  #assign dominant behavior to observations
for (i in 1:length(dat.list)) {
tmp<- matrix(0, nrow(dat.list[[i]]), 2)
sub<- theta.estim2[theta.estim2$id == unique(dat.list[[i]]$id),]
for (j in 1:nrow(sub)) {
ind<- which.max(sub[j,3:9])
tmp[j,1]<- names(ind) %>% as.character()
tmp[j,2]<- round(sub[j,(2+ind)], 3) %>% as.numeric()
}
colnames(tmp)<- c("behav","prop")
dat.list[[i]]<- cbind(dat.list[[i]], tmp)
dat.list[[i]]$behav<- dat.list[[i]]$behav %>% as.character()
dat.list[[i]]$prop<- dat.list[[i]]$prop %>% as.character()
}
#Convert to DF
dat2<- map_dfr(dat.list, `[`)
dat2$prop<- dat2$prop %>% as.numeric()
dat2
}
test<- assign_behav(dat.list, theta.estim2)
i=2
tmp<- matrix(0, nrow(dat.list[[i]]), 2)
sub<- theta.estim2[theta.estim2$id == unique(dat.list[[i]]$id),]
for (j in 1:nrow(sub)) {
ind<- which.max(sub[j,3:9])
tmp[j,1]<- names(ind) %>% as.character()
tmp[j,2]<- round(sub[j,(2+ind)], 3) %>% as.numeric()
}
i=3
tmp<- matrix(0, nrow(dat.list[[i]]), 2)
sub<- theta.estim2[theta.estim2$id == unique(dat.list[[i]]$id),]
for (j in 1:nrow(sub)) {
ind<- which.max(sub[j,3:9])
tmp[j,1]<- names(ind) %>% as.character()
tmp[j,2]<- round(sub[j,(2+ind)], 3) %>% as.numeric()
}
View(sub)
which.max(sub[j,3:9])
for (j in 1:nrow(sub)) {
print[j]
ind<- which.max(sub[j,3:9])
tmp[j,1]<- names(ind) %>% as.character()
tmp[j,2]<- round(sub[j,(2+ind)], 3) %>% as.numeric()
}
for (j in 1:nrow(sub)) {
print(j)
ind<- which.max(sub[j,3:9])
tmp[j,1]<- names(ind) %>% as.character()
tmp[j,2]<- round(sub[j,(2+ind)], 3) %>% as.numeric()
}
sub[5639,]
which.max(sub[5639,3:9])
tmp[j,1]<- names(ind) %>% as.character()
names(ind)
names(ind) %>% as.character()
tmp<- matrix(0, nrow(dat.list[[i]]), 2)
sub<- theta.estim2[theta.estim2$id == unique(dat.list[[i]]$id),]
View(sub)
View(theta.estim2)
View(theta.estim)
theta.estim2 %>% filter(id==6) %>% tally()
dat %>% filter(id==6) %>% tally()
nrow(theta.estim)
View(theta.estim)
i=55
ind<- which(dat$id == theta.estim$id[i] & dat$tseg == theta.estim$tseg[i])
dat[ind,]
View(nobs)
unique(dat$tseg)
View(obs)
View(dat.list)
apply(obs[-c(1,2)], 1, sum)
apply(obs[-c(1,2)], 1, sum)[55]
apply(obs[,11:16], 1, sum)[55]
View(behav.res)
View(nobs)
dat[dat$tseg==0,]
library(tidyverse)
library(tictoc)
library(furrr)
library(viridis)
source('gibbs functions2.R')
source('helper functions.R')
source('gibbs sampler2.R')
set.seed(2)
library('MCMCpack')
library('Rcpp')
library(progress)
library(tidyverse)
library(lubridate)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
source('LDA_behavior_function.R')
source('gibbs sampler.R')
source('helper functions.R')
sourceCpp('aux1.cpp')
#get data
dat<- read.csv('Snail Kite Gridded Data_larger_behav.csv', header = T, sep = ',')
dat$date<- dat$date %>% as_datetime()
dat.list<- df.to.list(dat)
obs<- get.summary.stats_behav(dat)
#prepare for Gibbs sampler
ngibbs=1000
nburn=ngibbs/2
ind1=grep('y1',colnames(obs))
ind2=grep('y2',colnames(obs))
nmaxclust=max(length(ind1),length(ind2))-1  #max possible is 1 fewer than largest number of bins
res=LDA_behavior_gibbs(dat=obs,gamma1=gamma1,alpha=alpha,
ngibbs=ngibbs,nmaxclust=nmaxclust,
nburn=nburn)
#Check traceplot of log marginal likelihood
plot(res$loglikel,type='l')
#Extract and plots proportions of behaviors per time segment
theta.post<- res$theta[(nburn+1):ngibbs,] %>% apply(2, mean)  #calc mean of posterior
#Extract and plots proportions of behaviors per time segment
theta.post<- res$theta[(nburn+1):ngibbs,]
theta.estim<- theta.post %>% apply(2, mean) %>% matrix(nrow(obs), nmaxclust) #calc mean of posterior
View(theta.estim)
apply(theta.estim, 1, sum)
boxplot(theta.estim)
#Determine proportion of behaviors (across all time segments)
#Possibly set threshold below which behaviors are excluded
round(apply(theta.estim, 2, sum)/nrow(theta.estim), digits = 3)
behav.res<- get_behav_hist(res)
View(behav.res)
#Plot histograms of frequency data
ggplot(behav.res, aes(x = bin, y = count, fill = behav)) +
geom_bar(stat = 'identity') +
scale_fill_viridis_c(guide = F, direction = -1) +
labs(x = "\nBin", y = "Frequency\n") +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14), strip.text.x = element_text(face = "bold")) +
facet_grid(param ~ behav, scales = "free_y")
#Plot histograms of proportion data
ggplot(behav.res, aes(x = bin, y = prop, fill = behav)) +
geom_bar(stat = 'identity') +
scale_fill_viridis_c(guide = F, direction = -1) +
labs(x = "\nBin", y = "Proportion\n") +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14), strip.text.x = element_text(face = "bold")) +
facet_grid(param ~ behav, scales = "fixed")
#Assign behaviors (via theta) to each time segment
theta.estim<- data.frame(id = obs$id, tseg = obs$tseg, theta.estim)
View(theta.estim)
names(theta.estim)<- c("id", "tseg", 1:nmaxclust)  #define behaviors
nobs<- purrr::map_dfr(dat.list, obs.per.tseg)  #calc obs per tseg
View(nobs)
#Create augmented matrix by replicating rows (tsegs) according to obs per tseg
theta.estim2<- aug_behav_df(dat = dat, theta.estim = theta.estim, nobs = nobs)
i=55
ind<- which(dat$id == theta.estim$id[i] & dat$tseg == theta.estim$tseg[i])
rep(theta.estim[i,], nobs$n[i])
rep(theta.estim[i,], nobs$n[i])
rep(theta.estim[i,], nobs$n[i]) %>%
unlist()
rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
for (i in 1:nrow(theta.estim)) {
ind<- which(dat$id == theta.estim$id[i] & dat$tseg == theta.estim$tseg[i])
if (i == 1) {
theta.estim2<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
} else {
tmp<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
theta.estim2<- rbind(theta.estim2, tmp)
}
}
for (i in 1:nrow(theta.estim)) {
print(i)
ind<- which(dat$id == theta.estim$id[i] & dat$tseg == theta.estim$tseg[i])
if (i == 1) {
theta.estim2<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
} else {
tmp<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
theta.estim2<- rbind(theta.estim2, tmp)
}
}
View(nobs)
View(theta.estim)
theta.estim %>% group_by(id, tseg) %>% tally()
View(obs)
# nobs<- purrr::map_dfr(dat.list, obs.per.tseg)  #calc obs per tseg
nobs<- data.frame(id = obs$id, tseg = obs$tseg, n = apply(obs[,11:16], 1, sum))
#Create augmented matrix by replicating rows (tsegs) according to obs per tseg
theta.estim2<- aug_behav_df(dat = dat, theta.estim = theta.estim, nobs = nobs)
for (i in 1:nrow(theta.estim)) {
print(i)
ind<- which(dat$id == theta.estim$id[i] & dat$tseg == theta.estim$tseg[i])
if (i == 1) {
theta.estim2<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
} else {
tmp<- rep(theta.estim[i,], nobs$n[i]) %>%
unlist() %>%
matrix(nrow = nobs$n[i], ncol = ncol(theta.estim), byrow = TRUE)
theta.estim2<- rbind(theta.estim2, tmp)
}
}
View(nobs)
dat %>% filter(id==12) %>% filter(tseg==8)
dat %>% filter(id==12) %>% unique(tseg)
dat %>% filter(id==12) %>% unique(.$tseg)
dat[dat$id==12,"tseg"] %>% unique()
View(obs)
#get data
dat<- read.csv('Snail Kite Gridded Data_larger_behav.csv', header = T, sep = ',')
dat[dat$id==12,"tseg"] %>% unique()
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library('MCMCpack')
library('Rcpp')
library(progress)
library(tidyverse)
library(lubridate)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
source('LDA_behavior_function.R')
source('gibbs sampler.R')
source('helper functions.R')
sourceCpp('aux1.cpp')
############################
#### Load and Prep Data ####
############################
#get data
dat<- read.csv('Snail Kite Gridded Data_larger_behav.csv', header = T, sep = ',')
dat$date<- dat$date %>% as_datetime()
dat.list<- df.to.list(dat)
obs<- get.summary.stats_behav(dat)
#prepare for Gibbs sampler
ngibbs=1000
nburn=ngibbs/2
ind1=grep('y1',colnames(obs))
ind2=grep('y2',colnames(obs))
nmaxclust=max(length(ind1),length(ind2))-1  #max possible is 1 fewer than largest number of bins
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library('MCMCpack')
library('Rcpp')
library(progress)
library(tidyverse)
library(lubridate)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
source('LDA_behavior_function.R')
source('gibbs sampler.R')
source('helper functions.R')
sourceCpp('aux1.cpp')
############################
#### Load and Prep Data ####
############################
#get data
dat<- read.csv('Snail Kite Gridded Data_larger_behav.csv', header = T, sep = ',')
dat$date<- dat$date %>% as_datetime()
dat.list<- df.to.list(dat)
obs<- get.summary.stats_behav(dat)
#prepare for Gibbs sampler
ngibbs=1000
nburn=ngibbs/2
ind1=grep('y1',colnames(obs))
ind2=grep('y2',colnames(obs))
nmaxclust=max(length(ind1),length(ind2))-1  #max possible is 1 fewer than largest number of bins
set.seed(2)
#####################################################
#### Run Gibbs Sampler on All IDs Simultaneously ####
#####################################################
res=LDA_behavior_gibbs(dat=obs,gamma1=gamma1,alpha=alpha,
ngibbs=ngibbs,nmaxclust=nmaxclust,
nburn=nburn)
#Check traceplot of log marginal likelihood
plot(res$loglikel,type='l')
#Extract and plots proportions of behaviors per time segment
theta.post<- res$theta[(nburn+1):ngibbs,]
theta.estim<- theta.post %>% apply(2, mean) %>% matrix(nrow(obs), nmaxclust) #calc mean of posterior
boxplot(theta.estim)
#Determine proportion of behaviors (across all time segments)
#Possibly set threshold below which behaviors are excluded
round(apply(theta.estim, 2, sum)/nrow(theta.estim), digits = 3)
boxplot(theta.estim, xlab = "Behavior", ylab = "Probability of Occurrence")
#Check traceplot of log marginal likelihood
plot(res$loglikel,type='l', xlab = "Observations", ylab = "Log Marginal Likelihood")
#Determine proportion of behaviors (across all time segments)
#Possibly set threshold below which behaviors are excluded
round(apply(theta.estim, 2, sum)/nrow(theta.estim), digits = 3)
round(apply(theta.estim, 2, sum)/nrow(theta.estim), digits = 3)[1:3] %>% sum()
#lines
ggplot(theta.estim.long %>% filter(id == 1 | id == 12 | id == 19 | id == 27)) +
geom_path(aes(x=time1, y=prop, color = behavior)) +
labs(x = "\nObservation", y = "State Probability\n") +
scale_color_viridis_d("Behavior", direction = -1) +
theme_bw() +
theme(axis.title = element_text(size = 16), axis.text.y = element_text(size = 14),
axis.text.x.bottom = element_text(size = 12),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
facet_wrap(~id, scales = "free_x")
ind<- which(dat2 %>% filter(id == 1 | id == 12 | id == 19 | id == 27))
behav.res<- get_behav_hist(res)
theta.estim<- data.frame(id = obs$id, tseg = obs$tseg, theta.estim)
names(theta.estim)<- c("id", "tseg", 1:nmaxclust)  #define behaviors
nobs<- data.frame(id = obs$id, tseg = obs$tseg, n = apply(obs[,11:16], 1, sum)) #calc obs per tseg
#Create augmented matrix by replicating rows (tsegs) according to obs per tseg
theta.estim2<- aug_behav_df(dat = dat, theta.estim = theta.estim, nobs = nobs)
#Change into long format
theta.estim.long<- theta.estim2 %>% gather(key, value, -id, -tseg, -time1, -date)
theta.estim.long$date<- theta.estim.long$date %>% as_datetime()
names(theta.estim.long)[5:6]<- c("behavior","prop")
#Add cluster assignments to original data; one column for dominant behavior and another for prop/prob to use for alpha of points
dat2<- assign_behav(dat.list = dat.list, theta.estim2 = theta.estim2)
ind<- which(dat2[dat2$id == 1 | dat2$id == 12 | dat2$id == 19 | dat2$id == 27,])
samp<- dat2[dat2$id == 1 | dat2$id == 12 | dat2$id == 19 | dat2$id == 27,]
ggplot() +
geom_sf(data = fl) +
coord_sf(xlim = c(min(dat$x-120000), max(dat$x+40000)),
ylim = c(min(dat$y-20000), max(dat$y+20000)), expand = FALSE) +
geom_path(data = samp, aes(x=x, y=y), color="gray60", size=0.25) +
geom_point(data = samp, aes(x, y, fill=behav), size=2.5, pch=21, alpha=samp$prop) +
scale_fill_viridis_d("Behavior", direction = -1) +
labs(x = "Longitude", y = "Latitude") +
theme_bw() +
theme(axis.title = element_text(size = 16),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
guides(fill = guide_legend(label.theme = element_text(size = 12),
title.theme = element_text(size = 14))) +
facet_wrap(~id)
#load map data
usa <- ne_states(country = "United States of America", returnclass = "sf")
fl<- usa %>% filter(name == "Florida")
fl<- st_transform(fl, crs = "+init=epsg:32617") #change projection to UTM 17N
ggplot() +
geom_sf(data = fl) +
coord_sf(xlim = c(min(dat$x-120000), max(dat$x+40000)),
ylim = c(min(dat$y-20000), max(dat$y+20000)), expand = FALSE) +
geom_path(data = samp, aes(x=x, y=y), color="gray60", size=0.25) +
geom_point(data = samp, aes(x, y, fill=behav), size=2.5, pch=21, alpha=samp$prop) +
scale_fill_viridis_d("Behavior", direction = -1) +
labs(x = "Longitude", y = "Latitude") +
theme_bw() +
theme(axis.title = element_text(size = 16),
strip.text = element_text(size = 14, face = "bold"),
panel.grid = element_blank()) +
guides(fill = guide_legend(label.theme = element_text(size = 12),
title.theme = element_text(size = 14))) +
facet_wrap(~id)
